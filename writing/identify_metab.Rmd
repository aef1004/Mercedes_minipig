---
title: "Identify_metab"
author: "Amy Fox"
date: "7/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(purrr)
library(tidyr)
library(broom)
library(ggplot2)
```

Pop 17, Phenylpyruvic acid, KEGGID:C00166, Query mass: 182.0791887, metab_637

```{r}
read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  filter(mz <183 & mz>182)
```

Read in the flow metab data for plotting
```{r}

metabolites <- read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  dplyr::rename(metaboliteID = X) %>%
  select(metaboliteID, contains("Minipig")) %>%
  pivot_longer(cols = c(-metaboliteID), names_to = "full_name", values_to = "metabolite_expression") %>%
  mutate(metaboliteID = str_replace(metaboliteID, "[:digit:]*", paste0("metab_", metaboliteID)))%>%
  filter(!grepl("Pooled", full_name))


load("../data/flow_predefined_phenotypes.gz")
load("../data/flow_single_expression.gz")
load("../data/flow_fe.gz")

flow_metab1 <- left_join(flow_predefined_phenotypes, metabolites, by = "full_name") %>%
  rename(percent = marker_percent,
         flow = phenotype,
         vaccine_status = group) 

flow_metab2 <-left_join(flow_fe, metabolites, by = "full_name")%>%
  rename(percent = percentage,
         flow = population)

flow_metab3 <-left_join(flow_single_expression, metabolites, by = "full_name") %>%
  rename(flow = marker)

flow_metab <- rbind(flow_metab1, flow_metab2, flow_metab3) %>%
  mutate(timepoint = str_extract(full_name, "[0-9]*[:alpha:]*$"))

unique(flow_metab$flow)
```

Function to plot the data
```{r}

plot_pick_metab <- function(df, flow_pop, metab_pick, x_position, yposition1, yposition2) {
  
  step1 <- df %>%
  filter(flow == flow_pop & metaboliteID == metab_pick) %>%
  group_by(flow, metaboliteID) %>%
  nest() %>%
  mutate(model = map(data, ~lm(percent ~ metabolite_expression, data = .)),
         summary_model = map(model, tidy)) %>%
unnest(summary_model) %>%
  filter(term != "(Intercept)") %>%
  select(flow, metaboliteID, estimate, model) %>%
  mutate(tidy_model = map(model, broom::glance)) %>%
  unnest(tidy_model) %>%
  select(flow, metaboliteID, adj.r.squared, p.value, estimate) %>%
  ungroup() %>%
  select(flow, metaboliteID, adj.r.squared, p.value) %>%
  unique() 

# plot after I bring down the number of metabolites to a reasonable number
df %>%
  filter(flow == flow_pop & metaboliteID == metab_pick) %>%
  left_join(step1, by = c("flow", "metaboliteID")) %>%
ggplot(aes(x = percent, y = metabolite_expression, color = factor(timepoint))) +
  geom_point(size = 3) +
  geom_smooth(aes(x = percent, y = metabolite_expression), method = "lm", se = FALSE, color = "#3F4788FF") +
  geom_text(aes(x = x_position, y = yposition1, 
                                   label = paste("r^2 == ",
                                                 round(adj.r.squared, 2))), parse = TRUE, color = "black") +
  geom_text(aes(x = x_position, y = yposition2, 
                                   label = paste("p == ",
                                                 signif(p.value, 2))), parse = TRUE, color = "black") +
  ggtitle(metab_pick) +
  labs(color = "Timepoint", x = paste(flow_pop, "Percentage of Cells"), y = "Metabolite Expression", fill = "Timepoint") +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 18),
        title = element_text(size = 18))
}


```




Visualize picked out 
```{r}

# phosphadydyocholine
plot_pick_metab(flow_metab, "CD3", "metab_3709", "Metabolite 3709", 72, 1E5, 5E4) 

# Phenylpyruvic acid
plot_pick_metab(flow_metab, "Pop17", "metab_637", "Metabolite 637", 10, 5E4, 4.5E4)
```

Phenylalanine Metabolism
KEGG IDs found in data

- C00079 (L-Phenylalanine) - mz = 166.0837488 (metab 563)
- C00166 (Phenylpyruvic acid) - mz = 182.0791887 (metab 637)
- C02763 (Enol-phenylpyruvate) - mz = 182.0791887 (metab 637)
- C00082 (L-Tyrosine) - mz = 182.0791887 (metab 637)
- C05852 (ortho-Hydroxyphenylacetic acid) - mz = 170.0809458 (metab 586 or metab 587)
- C01586 (Hippuric acid) - mz = 162.0549325 (metab 547)
- C00601 (Phenylacetaldehyde) - mz = 121.0657818 (metab 232)


166.0837
```{r}
read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  filter(between(mz, 121, 122))


plot_pick_metab(flow_metab, "Pop17", "metab_563", "Metabolite 563", 10, 5E4, 4.5E4)
plot_pick_metab(flow_metab, "Pop17", "metab_637", "Metabolite 637", 10, 5E4, 4.5E4)
plot_pick_metab(flow_metab, "Pop17", "metab_586", "Metabolite 586", 10, 5E4, 4.5E4)
plot_pick_metab(flow_metab, "Pop17", "metab_587", "Metabolite 587", 10, 1E4, 7.5E3)
plot_pick_metab(flow_metab, "Pop17", "metab_547", "Metabolite 547", 10, 2.5E4, 2E4)
plot_pick_metab(flow_metab, "Pop17", "metab_232", "Metabolite 232", 10, 2.5E4, 2E4)
```
CD3 same sign metab
KEGG IDs found in data

- C00157 (Phosphatidylcholine) - mz = 899.6365494 (metab 3709) OR 901.6402752 (metab 3715)
- C00350 (Phosphatidylethanolamine) - mz = 900.6396874 (metab 3713)
```{r}
read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  filter(between(mz, 900, 901))


plot_pick_metab(flow_metab, "CD3", "metab_3709", "Metabolite 3709", 75, 1E5, 5E4)
plot_pick_metab(flow_metab, "CD3", "metab_3715", "Metabolite 3715 ", 75, 2.5E4, 1.25E4)
plot_pick_metab(flow_metab, "CD3", "metab_3713", "Metabolite  3713", 75, 1E5, 5E4)
```
PCA Clustering

Cluster 1: Primary Bile Acids
KEGG ID: C05455, C06341, 

```{r}


hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C05455", "C06341", "C05453", "C00037", "C05445", "C17335", "C15518", "C04722")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "Pop7", "metab_6", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_1574", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_1862", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_1979", "Metabolite 6", 1, 2E4, 1E4)
```
PCA Clustering
Cluster2_0.2
Valine, Leucine, and isoleucine biosynthesis
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_Cluster2_0.2/name_map.csv") %>%
  filter(KEGG %in% c("C00188", "C00109", "C00671", "C00407", "C00123", "C00233", "C00141", "C00183")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_cluster2_0.2.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "Pop7", "metab_110", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_155", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_183", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_194", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_225", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_328", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_352", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_375", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_400", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_402", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_403", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_415", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_459", "Metabolite 6", 1, 2E4, 1E4)
```

PCA Clustering
Cluster2_0.2
Phenylalanine metabolism
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_Cluster2_0.2/name_map.csv") %>%
  filter(KEGG %in% c("C00079", "C05332", "C00601", "C07086", "C00166", "C05852", "C0082", "C02763", "C01586")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_cluster2_0.2.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "Pop7", "metab_112", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_220", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_392", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_426", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_447", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_457", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_560", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_563", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_564", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_585", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_587", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_614", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_625", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_636", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_638", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_640", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_657", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_658", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_688", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_689", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_703", "Metabolite 6", 1, 2E4, 1E4)
plot_pick_metab(flow_metab, "Pop7", "metab_793", "Metabolite 6", 1, 2E4, 1E4)

```
lower levels of metabolites after infection

Antigen signaling through the TCR increases phenylalanine, leucine, and glutamine uptake into CD8+ T cells, so maybe we're not seeing these metabolites in the serum because their taken up into the cells due to increase in antigen signaling due to infection



# PC4

PC4_Cluster1:	Arginine and proline metabolism

```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC4_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C05147", "C00763", "C03440", "C00148", "C05938", "C01165", "C01157", "C00025")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC4_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_85",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_456",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_496",  25, 2E4, 1E4)
```

PC4_Cluster1	**Phenylalanine metabolism**
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC4_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C00166", "C00082", "C02763")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC4_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_559",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_639",  25, 2E4, 1E4)
```

PC4_Cluster1	Phenylalanine, tyrosine and tryptophan biosynthesis
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC4_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C00166", "C00082")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC4_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_559",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_639",  25, 2E4, 1E4)
```

PC4_Cluster2	Arachidonic acid metabolism
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC4_Cluster2/name_map.csv") %>%
  filter(KEGG %in% c("C00157", "C00219", "C14768", "C14769", "C14770", "C14771", "C05966", "C05356", "C14823", "C14812", "C14748", "C14749", "C05965", "C14772", "C14773", "C14774", "C14775", "C14781", "C14813", "C04742", "C00909", "C04805", "C14782", "C14814", "C02165", "C02166", "C04853", "C05959", "C00639")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC4_cluster2.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_1223",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1280",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1287",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1289",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1342",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_2958",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_3072",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_3602",  25, 2E4, 1E4)


```

PC4 correlated with CD45RA, Pop10, Pop16, Pop 19, Pop24

PC4_Cluster2	Linoleic acid metabolism	

- Phosphatidylcholine
- Linoleate
- 9(10)-EpOME
- 12(13)-EpOME
- (9Z,11E)-(13S)-13-Hydroperoxyoctadeca-9,11-dienoic acid
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC4_Cluster2/name_map.csv") %>%
  filter(KEGG %in% c("C00157", "C01595", "C14825", "C14826", "C04717")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC4_cluster2.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_1011",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1081",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1082",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1083",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1101",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1102",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1169",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1186",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1263",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_1280",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_3602",  25, 2E4, 1E4)

```

PC5_Cluster1	Arginine and proline metabolism
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC5_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C00077", "C01165", "C00750", "C00025", "C01157", "C04281", "C05938", "C04282", "C05147", "C03440")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC5_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_302",  25, 1.5E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_494",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_503",  25, 2E4, 1E4)
plot_pick_metab(flow_metab, "CD45RA", "metab_731",  25, 2E4, 1E4)

```

PC5_Cluster1	D-Glutamine and D-glutamate metabolism
```{r}
hmdb_list <- read.csv("../data/saved_data/PCA/MetaboAnalyst_PC5_Cluster1/name_map.csv") %>%
  filter(KEGG %in% c("C00217", "C02237", "C00025")) %>%
  select(Query, KEGG) %>%
  rename(compound_id = Query)

cluster_data <- read.csv("../data/saved_data/PCA/HMDB_PC5_cluster1.csv") %>%
  select(-kegg_id) %>%
  filter(compound_id %in% hmdb_list$compound)


mass <- left_join(hmdb_list, cluster_data, by = "compound_id") %>%
  select(compound_id, query_mass, compound_name, KEGG) %>%
  mutate(query_mass = round(query_mass, 5))


read.csv("../data/peakTable_Minipig_Vaccinated_Unvaccinated_QC.csv") %>%
  mutate(mz = round(mz, 5)) %>%
  filter(mz %in% mass$query_mass)

plot_pick_metab(flow_metab, "CD45RA", "metab_302",  25, 1.5E4, 1E4)

```

